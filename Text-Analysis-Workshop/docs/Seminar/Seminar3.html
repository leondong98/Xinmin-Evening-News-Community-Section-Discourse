<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ç ”è®¨ä¼š3: è¯­è¨€æ¨¡å‹Aï¼šç›‘ç£å¼æ–‡æœ¬åˆ†ç±»å­¦ä¹  â€“ Text Analysis Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Text Analysis Workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-seminars" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Seminars</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-seminars">    
        <li>
    <a class="dropdown-item" href="../Seminar/Seminar1.html">
 <span class="dropdown-text">Seminar 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Seminar/Seminar2.html">
 <span class="dropdown-text">Seminar 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Seminar/Seminar3.html">
 <span class="dropdown-text">Seminar 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Seminar/Seminar4.html">
 <span class="dropdown-text">Seminar 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Seminar/Seminar5.html">
 <span class="dropdown-text">Seminar 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Seminar/Seminar6.html">
 <span class="dropdown-text">Seminar 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Seminar/Seminar7.html">
 <span class="dropdown-text">Seminar 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../ç®€å•Rå…¥é—¨.html">
 <span class="dropdown-text">ç®€å•Rå…¥é—¨</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../TidyverseåŒ…ä»‹ç».html">
 <span class="dropdown-text">TidyverseåŒ…ä»‹ç»</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../ä»£ç å¸®åŠ©.html">
 <span class="dropdown-text">ä»£ç å¸®åŠ©</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#ç ”è®¨ä¼š3-è¯­è¨€æ¨¡å‹aç›‘ç£å¼æ–‡æœ¬åˆ†ç±»å­¦ä¹ " id="toc-ç ”è®¨ä¼š3-è¯­è¨€æ¨¡å‹aç›‘ç£å¼æ–‡æœ¬åˆ†ç±»å­¦ä¹ " class="nav-link active" data-scroll-target="#ç ”è®¨ä¼š3-è¯­è¨€æ¨¡å‹aç›‘ç£å¼æ–‡æœ¬åˆ†ç±»å­¦ä¹ ">ç ”è®¨ä¼š3: è¯­è¨€æ¨¡å‹Aï¼šç›‘ç£å¼æ–‡æœ¬åˆ†ç±»å­¦ä¹ </a>
  <ul class="collapse">
  <li><a href="#å¯¹-nhs-è¯„è®ºè¿›è¡Œåˆ†ç±»" id="toc-å¯¹-nhs-è¯„è®ºè¿›è¡Œåˆ†ç±»" class="nav-link" data-scroll-target="#å¯¹-nhs-è¯„è®ºè¿›è¡Œåˆ†ç±»">3.1 å¯¹ NHS è¯„è®ºè¿›è¡Œåˆ†ç±»</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">3.1.1 Packages</a></li>
  <li><a href="#mac-ç”¨æˆ·åŠ è½½-quanteda.textmodels-é‡åˆ°é—®é¢˜çš„è¯´æ˜" id="toc-mac-ç”¨æˆ·åŠ è½½-quanteda.textmodels-é‡åˆ°é—®é¢˜çš„è¯´æ˜" class="nav-link" data-scroll-target="#mac-ç”¨æˆ·åŠ è½½-quanteda.textmodels-é‡åˆ°é—®é¢˜çš„è¯´æ˜">3.1.2 Mac ç”¨æˆ·åŠ è½½ <code>quanteda.textmodels</code> é‡åˆ°é—®é¢˜çš„è¯´æ˜ï¼š</a></li>
  <li><a href="#æ•°æ®" id="toc-æ•°æ®" class="nav-link" data-scroll-target="#æ•°æ®">3.1.3 æ•°æ®</a></li>
  <li><a href="#éšæœºæ•°ç”Ÿæˆ" id="toc-éšæœºæ•°ç”Ÿæˆ" class="nav-link" data-scroll-target="#éšæœºæ•°ç”Ÿæˆ">3.1.4 éšæœºæ•°ç”Ÿæˆ</a></li>
  <li><a href="#è®­ç»ƒé›†ä¸æµ‹è¯•é›†" id="toc-è®­ç»ƒé›†ä¸æµ‹è¯•é›†" class="nav-link" data-scroll-target="#è®­ç»ƒé›†ä¸æµ‹è¯•é›†">3.2 è®­ç»ƒé›†ä¸æµ‹è¯•é›†</a></li>
  <li><a href="#è¯å…¸dictionaries" id="toc-è¯å…¸dictionaries" class="nav-link" data-scroll-target="#è¯å…¸dictionaries">3.3 è¯å…¸ï¼ˆDictionariesï¼‰</a></li>
  <li><a href="#æœ´ç´ è´å¶æ–¯naive-bayes" id="toc-æœ´ç´ è´å¶æ–¯naive-bayes" class="nav-link" data-scroll-target="#æœ´ç´ è´å¶æ–¯naive-bayes">3.4 æœ´ç´ è´å¶æ–¯ï¼ˆNaive Bayesï¼‰</a></li>
  <li><a href="#è¯¾åæ€è€ƒ" id="toc-è¯¾åæ€è€ƒ" class="nav-link" data-scroll-target="#è¯¾åæ€è€ƒ">3.5 è¯¾åæ€è€ƒ</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ç ”è®¨ä¼š3: è¯­è¨€æ¨¡å‹Aï¼šç›‘ç£å¼æ–‡æœ¬åˆ†ç±»å­¦ä¹ </h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="ç ”è®¨ä¼š3-è¯­è¨€æ¨¡å‹aç›‘ç£å¼æ–‡æœ¬åˆ†ç±»å­¦ä¹ " class="level1">
<h1>ç ”è®¨ä¼š3: è¯­è¨€æ¨¡å‹Aï¼šç›‘ç£å¼æ–‡æœ¬åˆ†ç±»å­¦ä¹ </h1>
<p>è®²åº§äººï¼šHanxu hanxu.dong.21@ucl.ac.uk</p>
<p>
</p><p><a href="https://github.com/leondong98/Text-Analysis-Workshop/raw/main/Data/nhs_reviews.Rdata" style="display:inline-block; background-color:#4CAF50; color:white; padding:10px 20px; text-decoration:none; margin-right:10px; border-radius:5px;"> Seminar data </a></p>
<section id="å¯¹-nhs-è¯„è®ºè¿›è¡Œåˆ†ç±»" class="level2">
<h2 class="anchored" data-anchor-id="å¯¹-nhs-è¯„è®ºè¿›è¡Œåˆ†ç±»">3.1 å¯¹ NHS è¯„è®ºè¿›è¡Œåˆ†ç±»</h2>
<p>æ”¿åºœæä¾›çš„åŒ»ç–—æœåŠ¡è®©æ°‘ä¼—æœ‰å¤šæ»¡æ„/ä¸æ»¡æ„ï¼Ÿå…³äºè¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªæœ‰è¶£çš„æ•°æ®æ¥æºæ˜¯æ–‡æœ¬æ•°æ®ï¼Œå› ä¸ºåŒ»ç–—æœåŠ¡çš„ä½¿ç”¨è€…é€šå¸¸å¯ä»¥å¯¹ä»–ä»¬åœ¨æ¥å—æ”¿åºœæä¾›çš„åŒ»ç–—æœåŠ¡æ—¶çš„ä½“éªŒè¿›è¡Œè¯„è®ºå’Œåé¦ˆã€‚</p>
<p>åœ¨æœ¬æ¬¡ç ”è®¨è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æœ´ç´ è´å¶æ–¯æ¨¡å‹ï¼ˆNaive Bayesï¼‰æ¥é¢„æµ‹è‹±å›½æ‚£è€…å¯¹å…¨ç§‘è¯Šæ‰€ï¼ˆdoctorsâ€™ surgeriesï¼‰çš„è¯„è®ºæ˜¯æ­£é¢çš„è¿˜æ˜¯è´Ÿé¢çš„ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä»½æ‚£è€…å¯¹å±…ä½åœ°é™„è¿‘è‹±å›½å›½å®¶åŒ»ç–—æœåŠ¡ä½“ç³»ï¼ˆNHSï¼‰è®¾æ–½çš„è¯„è®ºè¯­æ–™åº“ã€‚</p>
</section>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">3.1.1 Packages</h2>
<p>åœ¨å¼€å§‹ç ”è®¨ä¼šæ—¶ï¼Œå…ˆä¸‹è½½/åŠ è½½ä»¥ä¸‹ R åŒ…ï¼š</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># å¦‚æœæ— æ³•åŠ è½½ quanteda.textmodels åŒ…ï¼Œè¯·è¿è¡Œä»¥ä¸‹ä»£ç </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ä»…é€‚ç”¨äº Windows ç”¨æˆ·ï¼ŒMac ç”¨æˆ·è¯·æŸ¥çœ‹ä¸‹æ–¹æ³¨é‡Šè¯´æ˜</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># remotes::install_github("quanteda/quanteda.textmodels")</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textmodels)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># å¦‚æœæ— æ³•åŠ è½½ caret åŒ…ï¼Œè¯·è¿è¡Œä»¥ä¸‹ä»£ç </span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("caret")</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="mac-ç”¨æˆ·åŠ è½½-quanteda.textmodels-é‡åˆ°é—®é¢˜çš„è¯´æ˜" class="level2">
<h2 class="anchored" data-anchor-id="mac-ç”¨æˆ·åŠ è½½-quanteda.textmodels-é‡åˆ°é—®é¢˜çš„è¯´æ˜">3.1.2 Mac ç”¨æˆ·åŠ è½½ <code>quanteda.textmodels</code> é‡åˆ°é—®é¢˜çš„è¯´æ˜ï¼š</h2>
<p>å¯¹äº Mac ç”¨æˆ·ï¼Œå½“å‰ä½¿ç”¨ <code>install.packages()</code> æˆ– <code>remotes::install_github()</code> å®‰è£… <code>quanteda.textmodels</code> åŒ…å¯èƒ½ä¼šé‡åˆ°é—®é¢˜ã€‚å› æ­¤ï¼Œä½ éœ€è¦ä½¿ç”¨ä»¥ä¸‹ï¼ˆç¨æ˜¾ç¹ççš„ï¼‰æ›¿ä»£æ–¹æ¡ˆï¼š</p>
<ol type="1">
<li>ç¬¬ä¸€æ­¥ï¼šå®‰è£… <code>gfortran</code> åœ¨ä½ çš„è®¡ç®—æœºä¸Šå®‰è£… <code>gfortran</code>ï¼Œä½ å¯ä»¥ä»ä»¥ä¸‹é“¾æ¥æ‰¾åˆ°ä¸ä½ ç³»ç»ŸåŒ¹é…çš„ç‰ˆæœ¬ï¼šğŸ”— https://github.com/fxcoudert/gfortran-for-macOS/releases å¦‚æœæç¤ºä½ æ²¡æœ‰å®Œæ•´çš„ç¼–è¯‘å·¥å…·é›†ï¼Œè¯·æŒ‰ç…§æç¤ºå®‰è£… Xcode å‘½ä»¤è¡Œå·¥å…·ã€‚</li>
<li>ç¬¬äºŒæ­¥ï¼šåœ¨ R ä¸­è¿è¡Œä»¥ä¸‹ä»£ç ï¼š</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">'~/.R'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">file.create</span>(<span class="st">'~/.R/Makevars'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li><p>ç¬¬ä¸‰æ­¥ï¼šå®šä½ Makevars æ–‡ä»¶ã€‚è¦å®šä½ç›¸å…³æ–‡ä»¶ï¼Œè¯·é€šè¿‡ Finder å‰å¾€ä½ çš„ä¸»ç›®å½•ï¼ˆä½ å¯ä»¥æ‰“å¼€ Finder ç„¶åæŒ‰ä¸‹ â‡§âŒ˜Hï¼‰ã€‚å¦‚æœä½ çœ‹ä¸åˆ° .R æ–‡ä»¶å¤¹ï¼Œé¦–å…ˆéœ€è¦æŒ‰ä¸‹ â‡§âŒ˜.ï¼ˆShift + Command + ç‚¹å·ï¼‰ï¼Œä»¥æ˜¾ç¤ºä½  Mac ä¸Šçš„éšè—æ–‡ä»¶ã€‚æ‰¾åˆ° .R æ–‡ä»¶å¤¹å¹¶æ‰“å¼€ï¼Œåœ¨å…¶ä¸­åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåä¸º Makevars çš„æ–‡ä»¶ã€‚</p>
<p>å®Œæˆåï¼Œå°†ä»¥ä¸‹å†…å®¹å¤åˆ¶ç²˜è´´åˆ°è¯¥æ–‡ä»¶ä¸­å¹¶ä¿å­˜ï¼š</p></li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode swift code-with-copy"><code class="sourceCode swift"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>FC <span class="op">=</span> <span class="op">/</span>opt<span class="op">/</span>homebrew<span class="op">/</span>Cellar<span class="op">/</span>gcc<span class="op">/</span><span class="fl">14.2.0</span><span class="op">/</span>bin<span class="op">/</span>gfortran</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>F77 <span class="op">=</span> <span class="op">/</span>opt<span class="op">/</span>homebrew<span class="op">/</span>Cellar<span class="op">/</span>gcc<span class="op">/</span><span class="fl">14.2.0</span><span class="op">/</span>bin<span class="op">/</span>gfortran</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>FLIBS <span class="op">=</span> <span class="op">-</span>L<span class="op">/</span>opt<span class="op">/</span>homebrew<span class="op">/</span>Cellar<span class="op">/</span>gcc<span class="op">/</span><span class="fl">14.2.0</span><span class="op">/</span>lib<span class="op">/</span>gcc<span class="op">/</span><span class="dv">11</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="4" type="1">
<li><p>ç¬¬å››æ­¥ï¼šç°åœ¨é‡å¯ Rã€‚</p></li>
<li><p>ç¬¬äº”æ­¥ï¼šæ¥ç€è¿è¡Œä»¥ä¸‹ä»£ç ï¼š</p></li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"quanteda/quanteda.textmodels"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="æ•°æ®" class="level2">
<h2 class="anchored" data-anchor-id="æ•°æ®">3.1.3 æ•°æ®</h2>
<p>æˆ‘ä»¬ä»Šå¤©çš„ç ”è®¨ä¼šå°†ä½¿ç”¨ä»¥ä¸‹æ•°æ®é›†ï¼š</p>
<p><strong>NHS æ‚£è€…è¯„è®º</strong> â€“ <code>nhs_reviews.Rdata</code> è¯¥æ–‡ä»¶åŒ…å«äº†è‹±å›½å„åœ° 2000 æ¡å…³äº NHS å…¨ç§‘è¯Šæ‰€çš„æ‚£è€…è¯„è®ºã€‚æ•°æ®ä¸­åŒ…å«ä»¥ä¸‹å˜é‡ï¼š</p>
<table class="caption-top table">
<colgroup>
<col style="width: 21%">
<col style="width: 78%">
</colgroup>
<thead>
<tr class="header">
<th>å˜é‡å</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>review_title</code></td>
<td>æ‚£è€…è¯„è®ºçš„æ ‡é¢˜</td>
</tr>
<tr class="even">
<td><code>review_text</code></td>
<td>æ‚£è€…è¯„è®ºçš„æ­£æ–‡</td>
</tr>
<tr class="odd">
<td><code>star_rating</code></td>
<td>æ‚£è€…ç»™å‡ºçš„æ˜Ÿçº§è¯„åˆ†ï¼ˆæ»¡åˆ†ä¸º 5 æ˜Ÿï¼‰</td>
</tr>
<tr class="even">
<td><code>review_positive</code></td>
<td>åˆ†ç±»å˜é‡ï¼šè‹¥è¯„åˆ†ä¸º 3 æ˜ŸåŠä»¥ä¸Šåˆ™ä¸º <code>"Positive"</code>ï¼Œå¦åˆ™ä¸º <code>"Negative"</code></td>
</tr>
<tr class="odd">
<td><code>review_date</code></td>
<td>è¯„è®ºçš„æ—¥æœŸ</td>
</tr>
<tr class="even">
<td><code>gp_response</code></td>
<td>åˆ†ç±»å˜é‡ï¼šè¡¨ç¤ºåŒ»ç”Ÿæ˜¯å¦å›å¤äº†è¯¥è¯„è®ºã€‚è‹¥å›å¤åˆ™ä¸º <code>"Responded"</code>ï¼Œå¦åˆ™ä¸º <code>"Has not responded"</code></td>
</tr>
</tbody>
</table>
<p>ä¸€æ—¦ä½ ä¸‹è½½äº†è¿™ä¸ªæ–‡ä»¶å¹¶å°†å…¶ä¿å­˜åœ¨ä¸€ä¸ªåˆé€‚çš„ä½ç½®ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†å…¶åŠ è½½åˆ° R ä¸­ï¼š</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"nhs_reviews.Rdata"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ä¸ä»¥å¾€ä¸€æ ·ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>tidyverse</code> è½¯ä»¶åŒ…ä¸­çš„ <code>glimpse()</code> å‡½æ•°å¿«é€ŸæŸ¥çœ‹æ•°æ®ä¸­çš„å˜é‡ï¼š</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(nhs_reviews)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Rows: 2,000
Columns: 6
$ review_title    &lt;chr&gt; "Great service", "Friendly helpful staff", "Excellent â€¦
$ review_text     &lt;chr&gt; "Phoned up to book a appointment receptionist very helâ€¦
$ star_rating     &lt;dbl&gt; 4, 5, 5, 1, 1, 5, 5, 5, 5, 1, 3, 5, 2, 5, 2, 5, 1, 1, â€¦
$ review_positive &lt;fct&gt; Positive, Positive, Positive, Negative, Negative, Posiâ€¦
$ review_date     &lt;date&gt; 2021-10-13, 2021-07-26, 2021-09-18, 2021-06-19, 2021-â€¦
$ gp_response     &lt;chr&gt; "Has not responded", "Responded", "Has not responded",â€¦  </code></pre>
</section>
<section id="éšæœºæ•°ç”Ÿæˆ" class="level2">
<h2 class="anchored" data-anchor-id="éšæœºæ•°ç”Ÿæˆ">3.1.4 éšæœºæ•°ç”Ÿæˆ</h2>
<p>æœ¬æ¬¡ç ”è®¨è¯¾éœ€è¦ä½ éšæœºç”Ÿæˆè®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚ä»»ä½•æ¶‰åŠéšæœºæ•°ç”Ÿæˆçš„è¿‡ç¨‹ï¼Œéƒ½ä¼šå¯¼è‡´ä½ æ¯æ¬¡è¿è¡Œä»£ç æ—¶å¯èƒ½å¾—åˆ°ä¸åŒçš„ç»“æœã€‚ä¾‹å¦‚ï¼Œé‡æ–°è¿è¡Œä»£ç æ—¶ï¼Œè¢«åˆ†é…åˆ°æµ‹è¯•é›†å’Œè®­ç»ƒé›†çš„è§‚æµ‹å€¼å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>
<p>å› æ­¤ï¼Œä¸ºäº†ä½¿ç»“æœå®Œå…¨å¯é‡å¤ï¼Œä½ éœ€è¦é¦–å…ˆä½¿ç”¨ <code>set.seed()</code> å‡½æ•°ã€‚è¯¥å‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ•´æ•°å€¼ã€‚ä¸€æ—¦ä½ è®¾ç½®äº†seedï¼ŒR æ¯æ¬¡è¿è¡Œæ—¶éƒ½ä¼šç”Ÿæˆç›¸åŒçš„éšæœºæ•°åºåˆ—ï¼Œä»è€Œä¿è¯ç»“æœä¸€è‡´:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>æˆ‘åœ¨è¿™é‡Œä½¿ç”¨äº† 12345ï¼Œä½†ä½ å¯ä»¥é€‰æ‹©ä»»ä½•ä½ å–œæ¬¢çš„æ•°å€¼ã€‚å¦‚æœä½ é€‰æ‹©äº†ä¸åŒçš„æ•°å­—ï¼Œé‚£ä¹ˆä½ çš„ç»“æœå¯èƒ½ä¼šä¸æˆ‘çš„ç•¥æœ‰ä¸åŒã€‚ä¸è¿‡ï¼Œåªè¦ä½ åœ¨æ¯æ¬¡è¿è¡Œ R è„šæœ¬æ—¶æ‰§è¡Œè¿™ä¸€è¡Œä»£ç ï¼Œä½ æ¯æ¬¡éƒ½ä¼šå¾—åˆ°ç›¸åŒçš„ç»“æœï¼</p>
</section>
<section id="è®­ç»ƒé›†ä¸æµ‹è¯•é›†" class="level2">
<h2 class="anchored" data-anchor-id="è®­ç»ƒé›†ä¸æµ‹è¯•é›†">3.2 è®­ç»ƒé›†ä¸æµ‹è¯•é›†</h2>
<ol type="1">
<li>åœ¨ <code>nhs_reviews</code> æ•°æ®ä¸­åˆ›å»ºä¸€ä¸ªæ–°å˜é‡ï¼Œç”¨äºæŒ‡ç¤ºæ¯æ¡è§‚æµ‹å±äºè®­ç»ƒé›†è¿˜æ˜¯æµ‹è¯•é›†ã€‚ç¡®ä¿å¤§çº¦ 80% çš„è§‚æµ‹è¢«åˆ†é…åˆ°è®­ç»ƒé›†ï¼Œ20% è¢«åˆ†é…åˆ°æµ‹è¯•é›†ï¼Œå°†è¯¥å˜é‡å‘½åä¸º <code>train</code>ï¼š</li>
</ol>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>nhs_reviews<span class="sc">$</span>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">size =</span> <span class="fu">nrow</span>(nhs_reviews), </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">replace =</span> <span class="cn">TRUE</span>, </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p><code>sample()</code> å‡½æ•°ä¼šä»æä¾›ç»™ <code>x</code> å‚æ•°çš„å…ƒç´ ä¸­éšæœºæŠ½æ ·ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ˜¯ä»ä¸€ä¸ªåªæœ‰ä¸¤ä¸ªå…ƒç´ çš„å‘é‡ <code>TRUE</code> å’Œ <code>FALSE</code> ä¸­è¿›è¡ŒæŠ½æ ·ã€‚</p>
</blockquote>
<blockquote class="blockquote">
<ul>
<li><code>size</code> å‚æ•°æŒ‡å®šä» <code>x</code> ä¸­è¦éšæœºé€‰æ‹©çš„å…ƒç´ æ•°é‡ï¼Œè¿™é‡Œæˆ‘ä»¬è¦æ±‚æŠ½æ ·çš„æ•°é‡ä¸ <code>nhs_reviews</code> æ•°æ®ä¸­çš„è§‚æµ‹å€¼æ•°é‡ç›¸åŒï¼›</li>
<li><code>replace</code> å‚æ•°æŒ‡å®šæ˜¯å¦æ”¾å›æŠ½æ ·ï¼ˆè¿™é‡Œæˆ‘ä»¬è¦è¿›è¡Œæ”¾å›æŠ½æ ·ï¼‰ï¼›</li>
<li><code>prob</code> å‚æ•°æ¥å—ä¸€ä¸ªå‘é‡ï¼Œè¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›ä»¥ä½•ç§æ¦‚ç‡æŠ½å– <code>x</code> ä¸­çš„æ¯ä¸ªå€¼ã€‚</li>
</ul>
</blockquote>
</details>
<ol start="2" type="1">
<li>å°† <code>nhs_reviews</code> æ•°æ®è½¬æ¢ä¸ºè¯­æ–™åº“`<code>corpus</code>ï¼Œç„¶åè½¬æ¢ä¸ºæ–‡æ¡£-ç‰¹å¾çŸ©é˜µ<code>DFM</code>, å¹¶è¿›è¡Œä¸€å®šçš„ç‰¹å¾é€‰æ‹©:</li>
</ol>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># è½¬æ¢ä¸ºè¯­æ–™åº“</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>nhs_reviews_corpus <span class="ot">&lt;-</span> <span class="fu">corpus</span>(nhs_reviews, <span class="at">text_field =</span> <span class="st">"review_text"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># è½¬æ¢ä¸º DFMï¼Œå¹¶ç§»é™¤è‹±æ–‡åœç”¨è¯</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm <span class="ot">&lt;-</span> nhs_reviews_corpus <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_remove</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p>è¯·è®°ä½ï¼Œç‰¹å¾é€‰æ‹©æ²¡æœ‰å”¯ä¸€â€œæ­£ç¡®â€çš„æ–¹å¼ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘åªæ˜¯ä½¿ç”¨äº†unigramï¼ˆå•è¯ï¼‰è¡¨ç¤ºï¼Œå¹¶ç§»é™¤äº†åœç”¨è¯ã€‚ä½ å¯ä»¥æ ¹æ®å®é™…ä»»åŠ¡åšå‡ºä¸åŒçš„é€‰æ‹©ã€‚</p>
</blockquote>
</details>
<ol start="3" type="1">
<li>ä½¿ç”¨ <code>dfm_subset()</code> å‡½æ•°å°†ä½ çš„ DFM æ‹†åˆ†ä¸ºè®­ç»ƒé›† DFM å’Œ æµ‹è¯•é›† DFMã€‚ ä½¿ç”¨ <code>dim()</code> å‡½æ•°ç¡®è®¤å®ƒä»¬æ˜¯å¦å…·æœ‰ä½ é¢„æœŸçš„è¡Œæ•°å’Œåˆ—æ•°:</li>
</ol>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># å­é›†ä¸ºè®­ç»ƒé›†è§‚æµ‹</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm_train <span class="ot">&lt;-</span> <span class="fu">dfm_subset</span>(nhs_reviews_dfm, train)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># å­é›†ä¸ºæµ‹è¯•é›†è§‚æµ‹ï¼ˆä½¿ç”¨é€»è¾‘é !ï¼‰</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm_test <span class="ot">&lt;-</span> <span class="fu">dfm_subset</span>(nhs_reviews_dfm, <span class="sc">!</span>train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p>è¿™é‡Œæˆ‘ä½¿ç”¨äº†é€»è¾‘è¿ç®—ç¬¦ <code>!</code>ï¼Œå®ƒä¼šåè½¬ <code>train</code> å‘é‡çš„ <code>TRUE</code> å’Œ <code>FALSE</code> å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>train</code> ä¸­ä¸º <code>TRUE</code> çš„å…ƒç´ åœ¨åŠ ä¸Š <code>!</code> åå˜ä¸º <code>FALSE</code>ï¼Œä¸º <code>FALSE</code> çš„å…ƒç´ å˜ä¸º <code>TRUE</code>ã€‚</p>
</blockquote>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(nhs_reviews_dfm_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>[1] 1578 7862  </code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(nhs_reviews_dfm_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>[1]  422 7862</code></pre>
<blockquote class="blockquote">
<p>æˆ‘ä»¬çš„ DFM æ‹†åˆ†ç»“æœä¸­ï¼Œè®­ç»ƒé›†å’Œæµ‹è¯•é›†åŒ…å«ä¸åŒæ•°é‡çš„æ–‡æ¡£ï¼ˆè¿™æ˜¯ç¬¦åˆé¢„æœŸçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰è®¾å®šäº† 80% ç”¨äºè®­ç»ƒï¼Œ20% ç”¨äºæµ‹è¯•ï¼‰ï¼Œä½†å®ƒä»¬åŒ…å«ç›¸åŒæ•°é‡çš„ç‰¹å¾ï¼ˆè¿™ä¹Ÿæ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºæˆ‘ä»¬è¦ä½¿ç”¨è¿™äº›ç‰¹å¾æ¥ä¸ºæµ‹è¯•é›†ç”Ÿæˆé¢„æµ‹ï¼‰ã€‚</p>
</blockquote>
</details>
</section>
<section id="è¯å…¸dictionaries" class="level2">
<h2 class="anchored" data-anchor-id="è¯å…¸dictionaries">3.3 è¯å…¸ï¼ˆDictionariesï¼‰</h2>
<ol type="1">
<li>ä½¿ç”¨ <code>dictionary()</code> å‡½æ•°æ„å»ºä¸€ä¸ªç®€å•çš„å­—å…¸ï¼Œå…¶ä¸­åŒ…å«ä¸€äº›ä½ è®¤ä¸ºèƒ½å¤Ÿä½“ç°æ‚£è€…è¯„è®ºä¸­ç§¯ææƒ…ç»ªçš„è¯æ±‡ã€‚å°†è¿™ä¸ªå­—å…¸åº”ç”¨åˆ°ä½ ä¹‹å‰åˆ›å»ºçš„è®­ç»ƒé›† DFMä¸Šï¼Œå¹¶åˆ›å»ºä¸€ä¸ªäºŒå…ƒå˜é‡ï¼šå½“æ–‡æœ¬ä¸­åŒ…å«æ¥è‡ªè¯¥å­—å…¸çš„è¯æ—¶è®¾ä¸º Positiveï¼Œå¦åˆ™è®¾ä¸º Negative:</li>
</ol>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>positive_dictionary <span class="ot">&lt;-</span> <span class="fu">dictionary</span>(<span class="fu">list</span>(<span class="at">positive =</span> <span class="fu">c</span>(<span class="st">"great"</span>, <span class="st">"excellent"</span>, <span class="st">"fantastic"</span>, <span class="st">"thank"</span>)))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># å°†å­—å…¸åº”ç”¨äºè®­ç»ƒé›† DFM</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>nhs_dictionary_dfm_train <span class="ot">&lt;-</span> <span class="fu">dfm_lookup</span>(<span class="at">x =</span> nhs_reviews_dfm_train,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">dictionary =</span> positive_dictionary)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># åˆ›å»ºä¸€ä¸ªé€»è¾‘ï¼ˆTRUE/FALSEï¼‰å‘é‡ï¼Œå¯¹æ¯æ¡è®­ç»ƒæ–‡æœ¬è¿›è¡Œæ ‡è®°</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>predicted_positive <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(nhs_dictionary_dfm_train[,<span class="dv">1</span>]) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># å°†é€»è¾‘å‘é‡è½¬æ¢ä¸ºå­—ç¬¦å‘é‡ï¼ŒTRUE èµ‹å€¼ä¸º "Positive"ï¼ŒFALSE èµ‹å€¼ä¸º "Negative"</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># å¹¶å°†ç»“æœèµ‹å€¼ç»™è®­ç»ƒé›†æ•°æ®</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>nhs_dictionary_dfm_train<span class="sc">$</span>predicted_positive_dictionary <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predicted_positive, <span class="st">"Positive"</span>, <span class="st">"Negative"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<ol start="2" type="1">
<li>ä½¿ç”¨ <code>table()</code> å‡½æ•°åˆ›å»ºä¸€ä¸ªæ··æ·†çŸ©é˜µ(confusion matrix)ï¼Œç”¨äºæ¯”è¾ƒé€šè¿‡å­—å…¸åº¦é‡é¢„æµ‹çš„æ­£é¢è¯„è®º (predicted_positive_dictionary) ä¸æ­£é¢è¯„è®ºçš„çœŸå®ç¼–ç ï¼ˆå­˜å‚¨åœ¨ <code>review_positive</code> å˜é‡ä¸­ï¼‰ã€‚å°† <code>table()</code> å‡½æ•°çš„è¾“å‡ºä¿å­˜ä¸ºä¸€ä¸ªæ–°å¯¹è±¡:</li>
</ol>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>confusion_dictionary <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">predicted_classification =</span> nhs_dictionary_dfm_train<span class="sc">$</span>predicted_positive_dictionary,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">true_classification =</span> nhs_dictionary_dfm_train<span class="sc">$</span>review_positive)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>confusion_dictionary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>                        true_classification
predicted_classification Negative Positive
                Negative      542      569
                Positive       36      421</code></pre>
</details>
<ol start="3" type="1">
<li>ä½¿ç”¨ <code>caret</code> åŒ…ä¸­çš„ <code>confusionMatrix()</code> å‡½æ•°æ¥è®¡ç®—å…³äºä½ çš„å­—å…¸åˆ†ç±»å™¨çš„å¤šç§æ€§èƒ½ç»Ÿè®¡é‡ã€‚ï¼ˆä½ è¿˜åº”è®¾ç½® <code>positive</code> å‚æ•°ä¸º â€œ<code>Positive</code>â€ï¼Œä»¥å‘ŠçŸ¥ R å“ªä¸ªç»“æœæ°´å¹³å¯¹åº”äºâ€œæ­£é¢â€ç»“æœã€‚ï¼‰é¢„æµ‹çš„å‡†ç¡®ç‡æ˜¯å¤šå°‘ï¼Ÿçµæ•åº¦æ˜¯å¤šå°‘ï¼Ÿç‰¹å¼‚æ€§æ˜¯å¤šå°‘ï¼Ÿè§£é‡Šè¿™äº›æ•°å€¼ã€‚å®ƒä»¬å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªå­—å…¸åœ¨åˆ†ç±»æ­£é¢æ‚£è€…è¯„è®ºæ–¹é¢çš„æ€§èƒ½å¦‚ä½•ï¼Ÿ</li>
</ol>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>confusion_dictionary_statistics <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(confusion_dictionary, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">positive =</span> <span class="st">"Positive"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>confusion_dictionary_statistics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Confusion Matrix and Statistics

                        true_classification
predicted_classification Negative Positive
                Negative      542      569
                Positive       36      421
                                          
               Accuracy : 0.6142          
                 95% CI : (0.5895, 0.6383)
    No Information Rate : 0.6314          
    P-Value [Acc &gt; NIR] : 0.9247          
                                          
                  Kappa : 0.3045          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.4253          
            Specificity : 0.9377          
         Pos Pred Value : 0.9212          
         Neg Pred Value : 0.4878          
             Prevalence : 0.6314          
         Detection Rate : 0.2685          
   Detection Prevalence : 0.2915          
      Balanced Accuracy : 0.6815          
                                          
       'Positive' Class : Positive     </code></pre>
<blockquote class="blockquote">
<p>æˆ‘ä»¬çš„å­—å…¸é¢„æµ‹çš„å‡†ç¡®ç‡ä¸º 61%ã€‚è™½ç„¶ç‰¹å¼‚æ€§å¾ˆé«˜â€”â€”è¾¾åˆ° 94%â€”â€”ä½†è¿™æ˜¯å› ä¸ºå­—å…¸å°†ç»å¤§å¤šæ•°è¯„è®ºéƒ½å½’ä¸ºéæ­£é¢è¯„è®ºï¼Œå› æ­¤æ­£ç¡®åœ°ä¸ºçœŸå®çš„éæ­£é¢è¯„è®ºåˆ†é…äº†è¯¥æ ‡ç­¾ã€‚çµæ•åº¦åˆ™ä½å¾—å¤šï¼Œä»…ä¸º 43%ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªæ­£ç¡®åœ°è¯†åˆ«äº†ä¸åˆ°ä¸€åŠçš„çœŸå®â€œæ­£é¢â€è¯„è®ºã€‚</p>
</blockquote>
<blockquote class="blockquote">
<p>è¿™æ˜¯å¯ä»¥ç†è§£çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸Šé¢ä½¿ç”¨çš„å­—å…¸éå¸¸ç®€çŸ­ï¼Œå› æ­¤å¾ˆå¯èƒ½æ¼æ‰äº†è®¸å¤šèƒ½è¡¨ç¤ºæ­£é¢æƒ…ç»ªçš„è¯æ±‡ã€‚</p>
</blockquote>
<blockquote class="blockquote">
<p>æˆ‘ä»¬å¯ä»¥å°è¯•é€šè¿‡ä¿®æ”¹å­—å…¸è¯åˆ—è¡¨å¹¶é‡æ–°æµ‹è¯•æ¥æå‡è¿™äº›åˆ†æ•°ï¼Œä½†æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä½¿ç”¨æœ´ç´ è´å¶æ–¯åˆ†ç±»æ¨¡å‹ï¼Œè®©æ¨¡å‹å­¦ä¹ å“ªäº›è¯ä¸æ­£é¢æˆ–è´Ÿé¢æ‚£è€…è¯„è®ºæœ€å¯†åˆ‡ç›¸å…³ã€‚</p>
</blockquote>
</details>
</section>
<section id="æœ´ç´ è´å¶æ–¯naive-bayes" class="level2">
<h2 class="anchored" data-anchor-id="æœ´ç´ è´å¶æ–¯naive-bayes">3.4 æœ´ç´ è´å¶æ–¯ï¼ˆNaive Bayesï¼‰</h2>
<ol type="1">
<li>ä½¿ç”¨ä½ ä¹‹å‰åˆ›å»ºçš„è®­ç»ƒé›† DFMï¼Œé€šè¿‡ <code>textmodel_nb()</code> å‡½æ•°æ¥ä¼°è®¡ä¸€ä¸ªé’ˆå¯¹ <code>review_positive</code> ç»“æœå˜é‡çš„æœ´ç´ è´å¶æ–¯æ¨¡å‹ã€‚</li>
</ol>
<p>è¯¥æ¨¡å‹æœ‰ä¸‰ä¸ªä¸»è¦å‚æ•°ï¼š</p>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 86%">
</colgroup>
<thead>
<tr class="header">
<th>å‚æ•°å</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>x</code></td>
<td>ç”¨äºè®­ç»ƒæœ´ç´ è´å¶æ–¯æ¨¡å‹çš„ DFMï¼ˆæ–‡æ¡£-ç‰¹å¾çŸ©é˜µï¼‰</td>
</tr>
<tr class="even">
<td><code>y</code></td>
<td>è¦é¢„æµ‹çš„ç»“æœå‘é‡ï¼ˆä¾‹å¦‚ï¼Œæ­¤å¤„ä¸º <code>review_positive</code>ï¼‰</td>
</tr>
<tr class="odd">
<td><code>prior</code></td>
<td>å¯¹ç»“æœå˜é‡ <code>y</code> çš„å„ç±»åˆ«çš„å…ˆéªŒåˆ†å¸ƒå½¢å¼ã€‚é€šå¸¸è®¾ä¸º <code>"docfreq"</code>ï¼Œå³æ¯ä¸ªç±»åˆ«çš„å…ˆéªŒæ¦‚ç‡å°†ç­‰äºè¯¥ç±»åˆ«åœ¨è®­ç»ƒæ•°æ®ä¸­çš„ç›¸å¯¹é¢‘ç‡</td>
</tr>
</tbody>
</table>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>nb_train <span class="ot">&lt;-</span> <span class="fu">textmodel_nb</span>(<span class="at">x =</span> nhs_reviews_dfm_train, </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> nhs_reviews_dfm_train<span class="sc">$</span>review_positive,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prior =</span> <span class="st">"docfreq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<ol start="2" type="1">
<li>æ£€æŸ¥ä½ æ‰€ä¼°è®¡çš„æœ´ç´ è´å¶æ–¯æ¨¡å‹ä¸­çš„ç±»åˆ«æ¡ä»¶è¯æ¦‚ç‡ï¼ˆclass-conditional word probabilitiesï¼‰ã€‚ï¼ˆæ­¤å¤„ä½¿ç”¨ <code>sort()</code> å‡½æ•°ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚ï¼‰ä½ å¯ä»¥ä½¿ç”¨ <code>coef()</code> å‡½æ•°å¯¹ä¼°è®¡å¾—åˆ°çš„æ¨¡å‹å¯¹è±¡è¿›è¡Œè°ƒç”¨æ¥è®¿é—®è¿™äº›æ¦‚ç‡ã€‚æ€è€ƒä»¥ä¸‹é—®é¢˜ï¼šåœ¨æ¯ä¸ªç±»åˆ«ï¼ˆæ­£é¢ / è´Ÿé¢ï¼‰ä¸‹ï¼Œå“ªäº›è¯çš„å‡ºç°æ¦‚ç‡æœ€é«˜ï¼Ÿè¯·æ³¨æ„ï¼Œå¦‚æœä½ åœ¨ç ”è®¨ä¼šä¸€å¼€å§‹åšäº†ä¸åŒçš„ç‰¹å¾é€‰æ‹©å†³ç­–ï¼Œä½ å¾—åˆ°çš„è¯åˆ—è¡¨å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœä½ æ²¡æœ‰ç§»é™¤åœç”¨è¯ï¼ˆstopwordsï¼‰ï¼Œä½ ä¼šå‘ç°ä¸¤ä¸ªç±»åˆ«ä¸‹éƒ½å¯¹è¿™äº›è¯èµ‹äºˆäº†é«˜æ¦‚ç‡ â€”â€” è¿™ä¹Ÿæ˜¯åˆç†çš„ï¼Œå› ä¸ºè¿™äº›è¯åœ¨æ‰€æœ‰æ‚£è€…è¯„è®ºä¸­éƒ½å¾ˆå¸¸è§ã€‚</li>
</ol>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">sort</span>(<span class="fu">coef</span>(nb_train)[,<span class="st">"Positive"</span>], <span class="at">decreasing =</span> T), <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>          .           ,       staff    practice     surgery appointment 
0.075829687 0.037050475 0.009988262 0.009241276 0.008921140 0.007619251 
     always          gp     service           !        time     helpful 
0.006061253 0.006061253 0.005997225 0.005890513 0.005762459 0.005719774 
      thank      doctor        care        well     doctors    friendly 
0.005463664 0.004652652 0.004545940 0.004481912 0.004183118 0.004076406 
  reception         get 
0.003670900 0.003606872    </code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">sort</span>(<span class="fu">coef</span>(nb_train)[,<span class="st">"Negative"</span>], <span class="at">decreasing =</span> T), <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>           .            ,  appointment          get         call      surgery 
 0.067243057  0.032460640  0.012294357  0.011874226  0.009021758  0.008667964 
           !         told        phone     practice         time           gp 
 0.008093048  0.007584468  0.007473908  0.006147178  0.006036618  0.005771272 
      doctor          day         back          one          can         just 
 0.004908898  0.004555103  0.004333982  0.004245533  0.004134973  0.004134973 
appointments            ? 
 0.004112860  0.004046524    </code></pre>
<blockquote class="blockquote">
<p>è¿™äº›è¯å¤§ä½“ä¸Šæ˜¯åˆç†çš„ã€‚åœ¨æ­£é¢å’Œè´Ÿé¢è¯„è®ºä¸­ï¼Œæ‚£è€…éƒ½å¯èƒ½ä½¿ç”¨ä¸åŒ»ç–—ç›¸å…³çš„è¯æ±‡ï¼Œä¾‹å¦‚ â€œstaffâ€ï¼ˆå·¥ä½œäººå‘˜ï¼‰ã€â€œpracticeâ€ï¼ˆè¯Šæ‰€ï¼‰ã€â€œsurgeryâ€ï¼ˆæ‰‹æœ¯/è¯Šæ‰€ï¼‰ã€â€œappointmentâ€ï¼ˆé¢„çº¦ï¼‰ã€â€œdoctorâ€ï¼ˆåŒ»ç”Ÿï¼‰ç­‰ã€‚ä½†åœ¨ â€œPositiveâ€ï¼ˆæ­£é¢ï¼‰ç±»åˆ«ä¸­ï¼Œè¯­è¨€æ¨¡å‹è¿˜å¯¹è®¸å¤šå…·æœ‰æ­£å‘æƒ…æ„Ÿçš„è¯èµ‹äºˆäº†æ›´é«˜çš„æ¦‚ç‡ï¼Œå¦‚ â€œthankâ€ï¼ˆæ„Ÿè°¢ï¼‰ã€â€œhelpfulâ€ï¼ˆæœ‰å¸®åŠ©çš„ï¼‰ã€â€œfriendlyâ€ï¼ˆå‹å¥½çš„ï¼‰ã€‚</p>
</blockquote>
<blockquote class="blockquote">
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨ â€œNegativeâ€ï¼ˆè´Ÿé¢ï¼‰ç±»åˆ«ä¸­ï¼Œæ¨¡å‹å¯¹ä¸€äº›å¯èƒ½ä¸ä¸æ»¡æ„æœåŠ¡ç›¸å…³çš„è¯èµ‹äºˆäº†æ›´é«˜çš„æ¦‚ç‡ï¼Œä¾‹å¦‚ â€œtimeâ€ï¼ˆæ—¶é—´ï¼‰ã€â€œserviceâ€ï¼ˆæœåŠ¡ï¼‰ã€â€œdayâ€ï¼ˆæ—¥å­ï¼‰ï¼Œä»¥åŠ â€œ!â€ï¼ˆæ„Ÿå¹å·ï¼‰ã€‚</p>
</blockquote>
</details>
<ol start="3" type="1">
<li>ä¼°è®¡æ¥è‡ªæœ´ç´ è´å¶æ–¯æ¨¡å‹çš„æ­£é¢è¯„è®ºé¢„æµ‹æ¦‚ç‡ã€‚ä½¿ç”¨è¿™äº›æ¦‚ç‡æ¥æ£€æŸ¥ <code>review_title</code> å˜é‡ï¼šå“ªäº›æ‚£è€…è¯„è®ºæ ‡é¢˜æœ€æœ‰å¯èƒ½æ˜¯æ­£é¢è¯„è®ºï¼Ÿå“ªäº›æœ€æœ‰å¯èƒ½æ˜¯è´Ÿé¢è¯„è®ºï¼Ÿè¿™äº›çœ‹èµ·æ¥åˆç†å—ï¼Ÿ</li>
</ol>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm_train<span class="sc">$</span>positive_nb_probability <span class="ot">&lt;-</span> <span class="fu">predict</span>(nb_train, <span class="at">type =</span> <span class="st">"probability"</span>)[,<span class="dv">2</span>]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm_train<span class="sc">$</span>review_title[<span class="fu">order</span>(nhs_reviews_dfm_train<span class="sc">$</span>positive_nb_probability, <span class="at">decreasing =</span> T)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code> [1] "Good GP Practice"                    "Efficient and compassionate service"
 [3] "Fantastic practice"                  "Caring and professional service"    
 [5] "Nurse was amazing"                   "Fantastic Practice"                 
 [7] "Consistently good care"              "Exemplary Practice"                 
 [9] "Fantastic practice"                  "Fantastic Practice"   </code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm_train<span class="sc">$</span>review_title[<span class="fu">order</span>(nhs_reviews_dfm_train<span class="sc">$</span>positive_nb_probability, <span class="at">decreasing =</span> F)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code> [1] "Shambles"                                    
 [2] "Unacceptable practice"                       
 [3] "Impossible to get a service"                 
 [4] "Unprofessional, Poor and Dangerous"          
 [5] "Impossible to get an appointment!!!"         
 [6] "Honestly, youâ€™re better off not having a GP" 
 [7] "Disappointed with appointments."             
 [8] "Not so great practice!!"                     
 [9] "Very bad practice and arrogant receptionists"
[10] "Extremely rude receptionist"   </code></pre>
<blockquote class="blockquote">
<p>æ˜¯çš„ï¼ä»è¿™äº›åˆ—è¡¨å¯ä»¥éå¸¸æ¸…æ¥šåœ°çœ‹å‡ºï¼Œè¯¥æ¨¡å‹åœ¨åŒºåˆ†æ­£é¢å’Œè´Ÿé¢è¯„è®ºæ–¹é¢è¡¨ç°å¾—ç›¸å½“ä¸é”™ã€‚ä½†è‹¥è¦ç¡®åˆ‡äº†è§£å…¶è¡¨ç°å¦‚ä½•ï¼Œæˆ‘ä»¬éœ€è¦åšçš„ä¸ä»…ä»…æ˜¯è¡¨é¢æ•ˆåº¦æ£€éªŒã€‚</p>
</blockquote>
</details>
<ol start="4" type="1">
<li>ä½¿ç”¨ä½ æ‹Ÿåˆå¥½çš„æœ´ç´ è´å¶æ–¯æ¨¡å‹å¯¹è®­ç»ƒæ•°æ®ä¸­çš„æ¯æ¡è§‚æµ‹è¿›è¡Œç±»åˆ«é¢„æµ‹ï¼ˆæ­£é¢æˆ–è´Ÿé¢ï¼‰ã€‚ç„¶åä½¿ç”¨ <code>table()</code> å‡½æ•°åˆ›å»ºä¸€ä¸ªæ··æ·†çŸ©é˜µï¼Œç”¨äºæ¯”è¾ƒé¢„æµ‹å‡ºçš„æ­£é¢è¯„è®ºä¸çœŸå®çš„æ­£é¢è¯„è®ºç¼–ç ï¼ˆå­˜å‚¨åœ¨ <code>review_positive</code> å˜é‡ä¸­ï¼‰ã€‚ä¸å­—å…¸åˆ†æä¸€æ ·ï¼Œå°† <code>table()</code> å‡½æ•°çš„è¾“å‡ºä¿å­˜ä¸ºä¸€ä¸ªæ–°å¯¹è±¡ã€‚</li>
</ol>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## è®­ç»ƒæ•°æ®é›†å‡†ç¡®ç‡</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm_train<span class="sc">$</span>predicted_classification_nb <span class="ot">&lt;-</span> <span class="fu">predict</span>(nb_train, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>confusion_train <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">predicted_classification =</span> nhs_reviews_dfm_train<span class="sc">$</span>predicted_classification_nb, </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">true_classification =</span> nhs_reviews_dfm_train<span class="sc">$</span>review_positive)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>confusion_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>                        true_classification
predicted_classification Negative Positive
                Negative      565       59
                Positive       13      931  </code></pre>
</details>
<ol start="5" type="1">
<li>ä½¿ç”¨ <code>confusionMatrix()</code> å‡½æ•°è®¡ç®—ä½ çš„åˆ†ç±»å™¨çš„å‡†ç¡®ç‡ï¼ˆaccuracyï¼‰ã€çµæ•åº¦ï¼ˆsensitivityï¼‰ å’Œç‰¹å¼‚æ€§ï¼ˆspecificityï¼‰ã€‚å°†è¿™äº›å¾—åˆ†ä¸ä½ ä»å­—å…¸åˆ†æä¸­è·å¾—çš„ç»“æœè¿›è¡Œæ¯”è¾ƒã€‚å“ªç§æ–¹æ³•è¡¨ç°æ›´å¥½ï¼Ÿ</li>
</ol>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>confusion_train_statistics <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(confusion_train, </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">positive =</span> <span class="st">"Positive"</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>confusion_train_statistics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Confusion Matrix and Statistics

                        true_classification
predicted_classification Negative Positive
                Negative      565       59
                Positive       13      931
                                          
               Accuracy : 0.9541          
                 95% CI : (0.9425, 0.9639)
    No Information Rate : 0.6314          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.903           
                                          
 Mcnemar's Test P-Value : 1.137e-07       
                                          
            Sensitivity : 0.9404          
            Specificity : 0.9775          
         Pos Pred Value : 0.9862          
         Neg Pred Value : 0.9054          
             Prevalence : 0.6314          
         Detection Rate : 0.5938          
   Detection Prevalence : 0.6020          
      Balanced Accuracy : 0.9590          
                                          
       'Positive' Class : Positive   </code></pre>
<blockquote class="blockquote">
<p>æœ´ç´ è´å¶æ–¯æ¨¡å‹æ˜¾ç„¶ä¼˜äºå­—å…¸åˆ†æã€‚è¯¥åˆ†ç±»å™¨çš„çµæ•åº¦ç°åœ¨ä¸º 94%ï¼Œå‡†ç¡®ç‡ä¸º 95%ã€‚ä½¿ç”¨æœ´ç´ è´å¶æ–¯æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒé›†ä¸­æ£€æµ‹æƒ…æ„Ÿçš„è¡¨ç°è¦å¥½å¾—å¤šã€‚</p>
</blockquote>
</details>
<ol start="6" type="1">
<li>é‡å¤è¯„ä¼°åˆ†ç±»å™¨çš„å‡†ç¡®æ€§ï¼Œä½†ç°åœ¨è¦è¯„ä¼°æµ‹è¯•æ•°æ®é›†ã€‚ä¸è®­ç»ƒæ•°æ®é›†ç›¸æ¯”ï¼Œåˆ†ç±»å™¨åœ¨è¿™äº›æ•°æ®ä¸Šçš„è¡¨ç°å¦‚ä½•ï¼Ÿ</li>
</ol>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">## æµ‹è¯•æ•°æ®é›†å‡†ç¡®æ€§</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm_test<span class="sc">$</span>predicted_classification_nb <span class="ot">&lt;-</span> <span class="fu">predict</span>(nb_train, </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newdata =</span> nhs_reviews_dfm_test, </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>confusion_test <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">predicted_classification =</span> nhs_reviews_dfm_test<span class="sc">$</span>predicted_classification_nb, </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">true_classification =</span> nhs_reviews_dfm_test<span class="sc">$</span>review_positive)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>confusion_test_statistics <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(confusion_test, </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">positive =</span> <span class="st">"Positive"</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>confusion_test_statistics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Confusion Matrix and Statistics

                        true_classification
predicted_classification Negative Positive
                Negative      170       35
                Positive        6      207
                                          
               Accuracy : 0.9019          
                 95% CI : (0.8693, 0.9287)
    No Information Rate : 0.5789          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8032          
                                          
 Mcnemar's Test P-Value : 1.226e-05       
                                          
            Sensitivity : 0.8554          
            Specificity : 0.9659          
         Pos Pred Value : 0.9718          
         Neg Pred Value : 0.8293          
             Prevalence : 0.5789          
         Detection Rate : 0.4952          
   Detection Prevalence : 0.5096          
      Balanced Accuracy : 0.9106          
                                          
       'Positive' Class : Positive </code></pre>
<blockquote class="blockquote">
<p>æµ‹è¯•æ•°æ®é›†ä¸Šçš„å‡†ç¡®ç‡ä¸º 90%ï¼Œçµæ•åº¦ä¸º 86%ï¼Œç‰¹å¼‚åº¦ä¸º 97%ã€‚æµ‹è¯•æ•°æ®é›†ä¸Šçš„è¡¨ç°æ¯”è®­ç»ƒæ•°æ®é›†ä¸Šçš„è¡¨ç°è¦å·®ä¸€äº›ï¼Œä½†ä»æ˜æ˜¾ä¼˜äºå­—å…¸åˆ†æã€‚</p>
</blockquote>
</details>
</section>
<section id="è¯¾åæ€è€ƒ" class="level2">
<h2 class="anchored" data-anchor-id="è¯¾åæ€è€ƒ">3.5 è¯¾åæ€è€ƒ</h2>
<ol type="1">
<li>ä» <code>nhs_reviews</code> æ•°æ®ä¸­åˆ›å»ºä¸¤ä¸ªæ–°çš„ DFMï¼Œæ¯æ¬¡éƒ½åšå‡ºä¸åŒçš„ç‰¹å¾é€‰æ‹©å†³ç­–ï¼ˆä¾‹å¦‚ï¼šè¯é¢‘ä¿®å‰ªï¼ˆtrimmingï¼‰ã€ä½¿ç”¨ n-gramã€æ˜¯å¦ç§»é™¤åœç”¨è¯ç­‰ï¼‰ã€‚ä½¿ç”¨è¿™äº› DFM è®­ç»ƒä¸¤ä¸ªæ–°çš„æœ´ç´ è´å¶æ–¯æ¨¡å‹ï¼Œå¹¶å°†å®ƒä»¬åœ¨æµ‹è¯•é›†æ•°æ®ä¸Šçš„è¡¨ç°ä¸ä½ ä¹‹å‰åˆ›å»ºçš„æ¨¡å‹è¿›è¡Œæ¯”è¾ƒã€‚ åˆ›å»ºä¸€ä¸ªè¡¨æ ¼ï¼Œæ¯”è¾ƒä½ æ‰€ä¼°ç®—æ¨¡å‹çš„ç»“æœï¼Œå’Œä½ ä¸ºæ¯ä¸ªæ¨¡å‹æ‰€åšçš„ç‰¹å¾é€‰æ‹©å†³ç­–ã€‚å“ªä¸ªæ¨¡å‹åœ¨å‡†ç¡®æ€§ã€çµæ•åº¦å’Œç‰¹å¼‚æ€§æ–¹é¢è¡¨ç°æœ€å¥½ï¼Ÿ</li>
</ol>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## æ— æ ‡ç‚¹çš„ DFM</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># è½¬æ¢ä¸º DFMï¼ˆç§»é™¤æ ‡ç‚¹ç¬¦å·ï¼‰</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm_nopunct <span class="ot">&lt;-</span> nhs_reviews_corpus <span class="sc">%&gt;%</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens</span>(<span class="at">remove_punct =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm</span>() </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># æå–è®­ç»ƒé›†ä¸­çš„è§‚æµ‹å€¼</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm_nopunct_train <span class="ot">&lt;-</span> <span class="fu">dfm_subset</span>(nhs_reviews_dfm_nopunct, train)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co"># æå–æµ‹è¯•é›†ä¸­çš„è§‚æµ‹å€¼</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm_nopunct_test <span class="ot">&lt;-</span> <span class="fu">dfm_subset</span>(nhs_reviews_dfm_nopunct, <span class="sc">!</span>train)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co"># è®­ç»ƒä¸€ä¸ªæ–°çš„æœ´ç´ è´å¶æ–¯æ¨¡å‹</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>nb_train_nopunct <span class="ot">&lt;-</span> <span class="fu">textmodel_nb</span>(<span class="at">x =</span> nhs_reviews_dfm_nopunct_train, </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> nhs_reviews_dfm_nopunct_train<span class="sc">$</span>review_positive,</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prior =</span> <span class="st">"docfreq"</span>)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="do">## æµ‹è¯•é›†å‡†ç¡®ç‡</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ä½¿ç”¨æ¨¡å‹å¯¹æµ‹è¯•é›†è¿›è¡Œé¢„æµ‹</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm_nopunct_test<span class="sc">$</span>predicted_classification <span class="ot">&lt;-</span> <span class="fu">predict</span>(nb_train_nopunct, </span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newdata =</span> nhs_reviews_dfm_nopunct_test, </span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a><span class="co"># åˆ›å»ºæ··æ·†çŸ©é˜µï¼šé¢„æµ‹ç±»åˆ« vs çœŸå®ç±»åˆ«</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>confusion_test_nopunct <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">predicted_classification =</span> nhs_reviews_dfm_nopunct_test<span class="sc">$</span>predicted_classification, </span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>                        <span class="at">true_classification =</span> nhs_reviews_dfm_nopunct_test<span class="sc">$</span>review_positive)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a><span class="co"># è®¡ç®—æ··æ·†çŸ©é˜µçš„æ€§èƒ½ç»Ÿè®¡ï¼ˆå‡†ç¡®ç‡ã€çµæ•åº¦ã€ç‰¹å¼‚æ€§ç­‰ï¼‰</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>confusion_test_nopunct_statistics <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(confusion_test_nopunct, <span class="at">positive =</span> <span class="st">"Positive"</span>)</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a><span class="co"># è¾“å‡ºç»Ÿè®¡ç»“æœ</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>confusion_test_nopunct_statistics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Confusion Matrix and Statistics

                        true_classification
predicted_classification Negative Positive
                Negative      169       34
                Positive        7      208
                                          
               Accuracy : 0.9019          
                 95% CI : (0.8693, 0.9287)
    No Information Rate : 0.5789          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8029          
                                          
 Mcnemar's Test P-Value : 4.896e-05       
                                          
            Sensitivity : 0.8595          
            Specificity : 0.9602          
         Pos Pred Value : 0.9674          
         Neg Pred Value : 0.8325          
             Prevalence : 0.5789          
         Detection Rate : 0.4976          
   Detection Prevalence : 0.5144          
      Balanced Accuracy : 0.9099          
                                          
       'Positive' Class : Positive  </code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="do">## N-gram æ¨¡å‹</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># è½¬æ¢ä¸º DFMï¼ˆä½¿ç”¨ 1 åˆ° 3 å…ƒçš„ n-gram ç‰¹å¾ï¼‰</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm_ngram <span class="ot">&lt;-</span> nhs_reviews_corpus <span class="sc">%&gt;%</span> </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_ngrams</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm</span>()</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># æå–è®­ç»ƒé›†ä¸­çš„è§‚æµ‹å€¼</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm_ngram_train <span class="ot">&lt;-</span> <span class="fu">dfm_subset</span>(nhs_reviews_dfm_ngram, train)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co"># æå–æµ‹è¯•é›†ä¸­çš„è§‚æµ‹å€¼</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm_ngram_test <span class="ot">&lt;-</span> <span class="fu">dfm_subset</span>(nhs_reviews_dfm_ngram, <span class="sc">!</span>train)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co"># è®­ç»ƒä¸€ä¸ªæ–°çš„æœ´ç´ è´å¶æ–¯æ¨¡å‹</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>nb_train_ngram <span class="ot">&lt;-</span> <span class="fu">textmodel_nb</span>(<span class="at">x =</span> nhs_reviews_dfm_ngram_train, </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> nhs_reviews_dfm_ngram_train<span class="sc">$</span>review_positive,</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prior =</span> <span class="st">"docfreq"</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="do">## æµ‹è¯•é›†å‡†ç¡®ç‡</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ä½¿ç”¨æ¨¡å‹å¯¹æµ‹è¯•é›†è¿›è¡Œé¢„æµ‹</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>nhs_reviews_dfm_ngram_test<span class="sc">$</span>predicted_classification <span class="ot">&lt;-</span> <span class="fu">predict</span>(nb_train_ngram, </span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newdata =</span> nhs_reviews_dfm_ngram_test, </span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a><span class="co"># åˆ›å»ºæ··æ·†çŸ©é˜µï¼šé¢„æµ‹ç±»åˆ« vs çœŸå®ç±»åˆ«</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>confusion_test_ngram <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">predicted_classification =</span> nhs_reviews_dfm_ngram_test<span class="sc">$</span>predicted_classification, </span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>                        <span class="at">true_classification =</span> nhs_reviews_dfm_ngram_test<span class="sc">$</span>review_positive)</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a><span class="co"># è®¡ç®—æ··æ·†çŸ©é˜µçš„æ€§èƒ½ç»Ÿè®¡ï¼ˆå‡†ç¡®ç‡ã€çµæ•åº¦ã€ç‰¹å¼‚æ€§ç­‰ï¼‰</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>confusion_test_ngram_statistics <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(confusion_test_ngram, <span class="at">positive =</span> <span class="st">"Positive"</span>)</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="co"># è¾“å‡ºç»Ÿè®¡ç»“æœ</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>confusion_test_ngram_statistics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Confusion Matrix and Statistics

                        true_classification
predicted_classification Negative Positive
                Negative      169       35
                Positive        7      207
                                          
               Accuracy : 0.8995          
                 95% CI : (0.8666, 0.9266)
    No Information Rate : 0.5789          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.7983          
                                          
 Mcnemar's Test P-Value : 3.097e-05       
                                          
            Sensitivity : 0.8554          
            Specificity : 0.9602          
         Pos Pred Value : 0.9673          
         Neg Pred Value : 0.8284          
             Prevalence : 0.5789          
         Detection Rate : 0.4952          
   Detection Prevalence : 0.5120          
      Balanced Accuracy : 0.9078          
                                          
       'Positive' Class : Positive       </code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">&lt;-</span> <span class="fu">c</span>(confusion_test_statistics<span class="sc">$</span>overall[<span class="dv">1</span>],</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>              confusion_test_nopunct_statistics<span class="sc">$</span>overall[<span class="dv">1</span>],</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>              confusion_test_ngram_statistics<span class="sc">$</span>overall[<span class="dv">1</span>])</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">&lt;-</span> <span class="fu">c</span>(confusion_test_statistics<span class="sc">$</span>byClass[<span class="dv">1</span>],</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>                 confusion_test_nopunct_statistics<span class="sc">$</span>byClass[<span class="dv">1</span>],</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>                 confusion_test_ngram_statistics<span class="sc">$</span>byClass[<span class="dv">1</span>])</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">&lt;-</span> <span class="fu">c</span>(confusion_test_statistics<span class="sc">$</span>byClass[<span class="dv">2</span>],</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>                 confusion_test_nopunct_statistics<span class="sc">$</span>byClass[<span class="dv">2</span>],</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>                 confusion_test_ngram_statistics<span class="sc">$</span>byClass[<span class="dv">2</span>])</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>model_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Unigram"</span>, <span class="st">"No punctuation"</span>, <span class="st">"N-gram"</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(model_names,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>                      accuracy,</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>                      sensitivity,</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>                      specificity)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>results                                 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>     model_names  accuracy sensitivity specificity
1        Unigram 0.9019139   0.8553719   0.9659091
2 No punctuation 0.9019139   0.8595041   0.9602273
3         N-gram 0.8995215   0.8553719   0.9602273  </code></pre>
<blockquote class="blockquote">
<p>ä¸åŒç‰¹å¾é€‰æ‹©æ–¹æ³•ä¹‹é—´çš„å·®å¼‚å¾ˆå°ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºé¢„æµ‹ç§¯ææ€§æ˜¯ä¸€é¡¹éå¸¸ç®€å•çš„ä»»åŠ¡ï¼è¡¨ç¤ºç§¯ææ€§çš„è¯è¯­éå¸¸æ¸…æ™°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä»è¿™äº›æ•°æ®ä¸­è·å¾—å¼ºçƒˆçš„ä¿¡å·ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæƒ…å†µå¹¶éæ€»æ˜¯å¦‚æ­¤ï¼Œå°¤å…¶æ˜¯åœ¨æˆ‘ä»¬è¯•å›¾å¯¹ä¸€ä¸ªæ›´ç»†å¾®çš„æ¦‚å¿µæˆ–ä¸€ç»„æ›´ç²¾ç»†çš„ç±»åˆ«è¿›è¡Œåˆ†ç±»æ—¶ã€‚</p>
</blockquote>
</details>
<ol start="2" type="1">
<li>ğŸ’ªå›°éš¾ä»»åŠ¡ï¼šåœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œä½ åº”è¯¥å®ç° k æŠ˜äº¤å‰éªŒè¯(k-fold cross-validation)ï¼Œä»¥è¯„ä¼°ä½ åœ¨ä¸Šé¢ä¼°è®¡çš„ä¸€ä¸ªæœ´ç´ è´å¶æ–¯æ¨¡å‹çš„å‡†ç¡®ç‡ã€çµæ•åº¦å’Œç‰¹å¼‚æ€§ã€‚</li>
</ol>
<ol type="a">
<li>æˆ‘åœ¨ä¸‹é¢æä¾›äº†ä¸€äº›èµ·å§‹ä»£ç ï¼Œç”¨äºä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†æ¥å—ä¸€ä¸ªé€»è¾‘å€¼å‘é‡ä½œä¸ºè¾“å…¥ï¼Œè¯¥å‘é‡åº”å‘½åä¸º <code>held_out</code>ã€‚è¯¥å‘é‡åº”å¯¹äº¤å‰éªŒè¯ä¸­æ¯ä¸€æŠ˜çš„ä¿ç•™é›†è§‚æµ‹ä¸º <code>TRUE</code>ï¼Œè®­ç»ƒé›†è§‚æµ‹ä¸º <code>FALSE</code>ã€‚</li>
</ol>
<p>ä½ çš„ä»»åŠ¡æ˜¯å¡«å†™ä»£ç ä¸­ â€œ<code>ä½ çš„ä»£ç åœ¨è¿™é‡Œï¼</code>â€ çš„éƒ¨åˆ†ã€‚</p>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>get_performance_scores <span class="ot">&lt;-</span> <span class="cf">function</span>(held_out){</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ä¸ºè¯¥æŠ˜å è®¾ç½®è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  dfm_train <span class="ot">&lt;-</span> <span class="fu">dfm_subset</span>(nhs_reviews_dfm, <span class="sc">!</span>held_out)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  dfm_test <span class="ot">&lt;-</span> <span class="fu">dfm_subset</span>(nhs_reviews_dfm, held_out)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># åœ¨é held-out éƒ¨åˆ†è®­ç»ƒæ¨¡å‹</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>      <span class="co"># ä½ çš„ä»£ç åœ¨è¿™é‡Œï¼</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># å¯¹ held-out éƒ¨åˆ†è¿›è¡Œé¢„æµ‹</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># ä½ çš„ä»£ç åœ¨è¿™é‡Œï¼</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># åˆ›å»ºæ··æ·†çŸ©é˜µ,è®¡ç®—å‡†ç¡®æ€§ã€ç‰¹å¼‚æ€§å’Œçµæ•åº¦</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># ä½ çš„ä»£ç åœ¨è¿™é‡Œï¼</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># å°†ç»“æœä¿å­˜åœ¨ data.frame ä¸­</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>}  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>get_performance_scores <span class="ot">&lt;-</span> <span class="cf">function</span>(held_out){</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ä¸ºè¯¥æŠ˜å è®¾ç½®è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  dfm_train <span class="ot">&lt;-</span> <span class="fu">dfm_subset</span>(nhs_reviews_dfm, <span class="sc">!</span>held_out)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  dfm_test <span class="ot">&lt;-</span> <span class="fu">dfm_subset</span>(nhs_reviews_dfm, held_out)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># åœ¨é held-out éƒ¨åˆ†è®­ç»ƒæ¨¡å‹</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  nb_train <span class="ot">&lt;-</span> <span class="fu">textmodel_nb</span>(<span class="at">x =</span> dfm_train, </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> dfm_train<span class="sc">$</span>review_positive,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prior =</span> <span class="st">"docfreq"</span>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>   <span class="co"># å¯¹ held-out éƒ¨åˆ†è¿›è¡Œé¢„æµ‹</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  dfm_test<span class="sc">$</span>predicted_classification <span class="ot">&lt;-</span> <span class="fu">predict</span>(nb_train, </span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">newdata =</span> dfm_test, </span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># åˆ›å»ºæ··æ·†çŸ©é˜µ,è®¡ç®—å‡†ç¡®æ€§ã€ç‰¹å¼‚æ€§å’Œçµæ•åº¦</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  confusion_nb <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">predicted_classification =</span> dfm_test<span class="sc">$</span>predicted_classification,</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">true_classification =</span> dfm_test<span class="sc">$</span>review_positive)</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>  confusion_nb_statistics <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(confusion_nb, <span class="at">positive =</span> <span class="st">"Positive"</span>)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>  accuracy <span class="ot">&lt;-</span> confusion_nb_statistics<span class="sc">$</span>overall[<span class="dv">1</span>]</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>  sensitivity <span class="ot">&lt;-</span> confusion_nb_statistics<span class="sc">$</span>byClass[<span class="dv">1</span>]</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>  specificity <span class="ot">&lt;-</span> confusion_nb_statistics<span class="sc">$</span>byClass[<span class="dv">2</span>]</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(accuracy, sensitivity, specificity))</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>}         </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<ol start="2" type="a">
<li>å®Œæˆè¿™ä¸ªå‡½æ•°ä¹‹åï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªå‘é‡ï¼Œç”¨æ¥è¡¨ç¤ºä½ å°†åœ¨äº¤å‰éªŒè¯ä¸­æµ‹è¯•æ•°æ®æ‰€ä½¿ç”¨çš„å„ä¸ªæŠ˜ï¼ˆK foldsï¼‰ã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦ä½¿ç”¨ <code>sample()</code> å‡½æ•°ç”Ÿæˆä¸€ä¸ªå‘é‡ï¼Œè¯¥å‘é‡çš„å…ƒç´ æ•°é‡åº”ä¸ <code>nhs_reviews_dfm</code> å¯¹è±¡ä¸­çš„è¡Œæ•°ç›¸åŒã€‚</li>
</ol>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>K, <span class="fu">nrow</span>(nhs_reviews_dfm), <span class="at">replace =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<ol start="3" type="a">
<li>æœ€åï¼Œä½ éœ€è¦å°† <code>get_performance_scores()</code> å‡½æ•°åº”ç”¨åˆ°æ¯ä¸€ä¸ªæŠ˜ï¼ˆfoldï¼‰ä¸Šã€‚ä¸ºæ­¤ï¼Œ<code>lapply()</code> å‡½æ•°å¯èƒ½ä¼šå¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚è¿™ä¸ªå‡½æ•°å°†ä¸€ä¸ªå‘é‡ä½œä¸ºè¾“å…¥ï¼Œå¯¹è¯¥å‘é‡çš„æ¯ä¸ªå€¼åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªåˆ—è¡¨å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ä½ è¾“å…¥å‘é‡æ¯ä¸ªå€¼æ‰€å¯¹åº”çš„å‡½æ•°è¿è¡Œç»“æœã€‚</li>
</ol>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>all_folds <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>K, <span class="cf">function</span>(k) <span class="fu">get_performance_scores</span>(folds<span class="sc">==</span>k))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<ol start="4" type="a">
<li>è¾“å‡ºä½ çš„ç»“æœï¼</li>
</ol>
<details>
<summary>
Reveal Code
</summary>
<div class="sourceCode" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>all_folds <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>K, <span class="cf">function</span>(k) <span class="fu">get_performance_scores</span>(folds<span class="sc">==</span>k))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(<span class="fu">bind_rows</span>(all_folds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>   accuracy sensitivity specificity 
  0.9122027   0.8881802   0.9504991 </code></pre>
</details>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>